<!DOCTYPE html>
<html lang="zh_CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ë¥™ÂêÉËõá....</title>
  <script src="./js/jquery.min.js"></script>
  <style>
    * {
      padding: 0px;
      margin: 0px;
      box-sizing: border-box;

    }

    html {
      background-image: url(./bg.jpg);
    }

    .box {
      width: 1302px;
      height: 700px;
      margin: 10px auto;
      background: #fce6ac
    }

    .box div {
      width: 20px;
      height: 20px;
      /* border: 1px solid cornsilk; */
      float: left;

    }

    /* .active {
      
    } */

    .food {
      background: rgba(255, 20, 150, .5);
      animation: run 0.5s linear infinite;
      animation: light 0.5s linear infinite;
      border-radius: 50%;
      background-image: url(./image/ÂòâÁÑ∂.jpg);
      background-size: cover;
    }

    .zhangai {
      background: blue;
      background-image: url(./image/ÈªÑË±ÜÊµÅÊ±ó.jpg);
      background-size: cover;
    }


    @keyframes run {
      0% {
        background: rgba(255, 20, 150, .5);
      }

      100% {
        background: red;
      }
    }

    @keyframes light {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 20, 150, .5), 0 0 0 10px rgba(255, 20, 50, .4), 0 0 0 20px rgba(255, 20, 150, .3);
      }

      100% {
        box-shadow: 0 0 0 10px rgba(255, 20, 150, .5), 0 0 0 20px rgba(255, 20, 150, .4), 0 0 0 30px rgba(255, 20, 150, .3);
      }

    }

    .score {
      width: 50px;
      height: 50px;
      background: blanchedalmond;
      position: fixed;
      top: 10px;
      right: 50%;
      margin-right: 651px;
      font-size: 20px;
      text-align: center;
      line-height: 50px;
    }
  </style>
  <script>
    $(function () {
      var $box = $(".box");
      var index = 0 //ÁªôÊØè‰∏™ÊñπÊ†ºÁ¥¢Âºï
      for (var i = 0; i < 35; i++) { //ÂàùÂßãÁΩëÊ†º
        for (var j = 0; j < 65; j++) {
          $box.append("<div x=" + i + " y=" + j + " index=" + (index++) + "></div>")
        }
      }




      var snakeHead = $("[x=10][y=10]") //ÂàùÂßãËõáÂ§¥
      snakeHead.addClass("active")



      var snake = []  //ËõáÂÖ®Ë∫´ÁöÑÂùêÊ†á
      snake.push(snakeHead) //ËõáÂ§¥Ê∑ªÂä†
      var score = 0;

      var isfood = false //ÁïåÈù¢ÊòØÂê¶ÊúâÈ£üÁâ©
      var food = null;
      var direction = 39 //ÈªòËÆ§ÊñπÂêë ÊñπÂêëÊéßÂà∂
      var speed = 100;
      var proviousdirection = 0

      $(document).keydown(function (e) { //ÊñπÂêëÊéßÂà∂
        proviousdirection = direction
        direction = e.keyCode
        if (snake.length >= 2) {
          if (proviousdirection == 37 && direction == 39) {
            direction = 37
          }
          if (proviousdirection == 39 && direction == 37) {
            direction = 39
          }
          if (proviousdirection == 38 && direction == 40) {
            direction = 38
          }
          if (proviousdirection == 40 && direction == 38) {
            direction = 40
          }
        }
      })

      setFood()
      setzhangai()
      movesnake()


      function setFood() {
        setInterval(function () {
          if (!isfood) {
            while (true) {
              var footX = parseInt(Math.random() * 35)
              var footY = parseInt(Math.random() * 65)
              food = $("[x=" + footX + "][y=" + footY + "]");
              if (!food.hasClass("active")) {
                if (!isfood) {
                  food.addClass("food")
                  isfood = true;
                }
                break;
              }
            }
          }
        }, 100)
      }

      var hh = true;
      function setzhangai() {
        setInterval(function () {
          if (hh) {
            var footXX = parseInt(Math.random() * 35)
            var footYY = parseInt(Math.random() * 65)
            var iszhangai = $("[x=" + footXX + "][y=" + footYY + "]");
            if (!iszhangai.hasClass("active") && !iszhangai.hasClass("food")) {
              iszhangai.addClass("zhangai")
            }
          }
        }, 200)

      }

      function movesnake() { //ÈªòËÆ§ÂâçËøõ



        var timer = setInterval(function () {
          var currenthead = snake[snake.length - 1]
          var isDea = false;

          var x = currenthead.attr("x");
          var y = currenthead.attr("y");

          if (direction == 37) {
            currenthead.removeClass("active")
            currenthead.removeClass("head")
            currenthead = $("[x=" + x + "][y=" + (parseInt(y) - 1) + "]")
            if (currenthead.hasClass("active") || !currenthead[0]) {
              isDea = true
            }
          }

          if (direction == 39) {
            currenthead.removeClass("active")
            currenthead.removeClass("head")
            currenthead = $("[x=" + x + "][y=" + (parseInt(y) + 1) + "]")
            if (currenthead.hasClass("active") || !currenthead[0]) {
              isDea = true
            }
          }

          if (direction == 38) {
            currenthead.removeClass("active")
            currenthead.removeClass("head")
            currenthead = $("[x=" + (parseInt(x) - 1) + "][y=" + y + "]")
            if (currenthead.hasClass("active") || !currenthead[0]) {
              isDea = true
            }
          }

          if (direction == 40) {
            currenthead.removeClass("active")
            currenthead.removeClass("head")
            currenthead = $("[x=" + (parseInt(x) + 1) + "][y=" + y + "]")
            if (currenthead.hasClass("active") || !currenthead[0]) {
              isDea = true
            }
          }
          if (currenthead.hasClass("zhangai")) {
            isDea = true;
          }

          currenthead.addClass("active")
          $(".active").html("ü§ó")

          if (isDea) {
            clearInterval(timer)
            hh = false;
            alert("Ê∏∏ÊàèÁªìÊùüÔºåÊúÄÁªàÂæóÂàÜ" + $(".score").html())

          }



          var tempSnake = []
          tempSnake.push(currenthead)
          for (var i = snake.length - 1; i >= 1; i--) {
            snake[i].addClass("active")
            tempSnake.unshift(snake[i])
          }
          snake[0].removeClass("active")
          snake[0].html("")

          snake = tempSnake

          if (snake[snake.length - 1][0] == food[0]) { //ËõáÂ§¥Á¢∞ËßÅÈ£üÁâ©
            $(".box>div").removeClass("zhangai")
            $(".au")[0].play()
            score += 100;
            $(".score").html(score)

            if (score >= 1000) speed = 70;
            if (score >= 2000) speed = 50;
            if (score >= 3000) speed = 30;

            var currenthead = snake[0]
            console.log(currenthead[0])
            var xTop = currenthead.attr("x");
            var yTop = currenthead.attr("y");
            var newBody = null;
            if (direction == 37) {
              newBody = $("[x=" + xTop + "][y=" + (parseInt(yTop) + 1) + "]")
            }
            if (direction == 39) {
              newBody = $("[x=" + xTop + "][y=" + (parseInt(yTop) - 1) + "]")
            }
            if (direction == 38) {
              newBody = $("[x=" + (parseInt(xTop) + 1) + "][y=" + yTop + "]")
            }
            if (direction == 40) {
              newBody = $("[x=" + (parseInt(xTop) - 1) + "][y=" + yTop + "]")
            }
            newBody.addClass("active")
            snake.unshift(newBody)
            food.removeClass("food")
            isfood = false
          }
        }, speed)
      }
    })
  </script>
</head>

<body>
  <div class="box">

  </div>
  <div class="score">0
  </div>
  <audio src="./static/get.wav" class="au"></audio>
</body>

</html>